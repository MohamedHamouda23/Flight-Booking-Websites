<!-- Name: Mohamed Hammouda | Student ID: 23077543 -->

{% extends "base.html" %}

{% block title %}Home - Horizon Travel{% endblock %}

{% block content %}
<style>
    button  {

        padding: 10px;
        background-color: #000080;
        color: white;
        font-size: 16px;
        font-weight: bold;
        border: #000080;
        justify-content: center;
        align-items: center;
        transition: all 0.3s ease;
      
      }
    
    .form-group {
        display: flex;
        flex-direction: row;
        align-items: center;
        margin-bottom: 10px;
        width: 100%;
        max-width: 550px;
    }
    
    .form-group label {
        min-width: 130px;
        margin-right: 10px;
        font-weight: bold;
        text-align: left;
    }
    
    select,
    input {
        width: 100%;
        max-width: 280px;
        height: 38px;
        padding: 6px;
        border-radius: 4px;
        border: 1px solid #dbdcdd;
        font-size: 15px;
        margin-bottom: 5px;
        box-sizing: border-box;
        font-weight: bold;
        color: #333;
    }
    
    select {
        background-color: white;
        appearance: none;
        background-repeat: no-repeat;
        background-position: right 8px center;
        background-size: 1em;
    }
    
    form {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 8px;
        margin: 0 auto;
        width: 100%;
    }
    
    .rectangle-row {
        background-color: rgba(255, 255, 255, 0.95);
        padding: 15px;
        margin: 0 auto 20px auto;
        border-radius: 8px;
        width: 85%;
        max-width: 550px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .user-table-container {
        display: flex;
        justify-content: center;
        margin: 15px auto;
        width: 85%;
        max-width: 750px;
        overflow-x: auto;
    }
    
    .user-table {
        width: 100%;
        text-align: center;
        border-collapse: collapse;
        background-color: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    th,
    td {
        padding: 10px 6px;
        text-align: center;
        border: 1px solid #ddd;
        font-weight: bold;
        vertical-align: middle;
    }
    
    th {
        background-color: #000080;
        color: white;
        font-weight: bold;
    }
    
    table tr {
        background-color: #ffffff;
        border-bottom: 1px solid #ddd;
    }
    
    tr:last-child {
        border-bottom: none;
    }
    
    tr:hover {
        background-color: #f5f5f5;
    }
    
    .user-table form {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
    }
    
    .user-table tr:last-child td {
        text-align: center;
        padding: 12px 0;
    }
    
    .user-table tr:last-child td button {
        width: auto;
        min-width: 140px;
        margin: 0 auto;
    }
    
    .update-form {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
    }
    
    .update-button:hover {
        background-color: #1a237e;
    }
    
    .delete-form {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
    }
    
    .delete-button {
        background-color: #d9534f;
    }
    
    .delete-button:hover {
        background-color: #c9302c;
    }
    
    .value-input {
        width: 100%;
        max-width: 140px;
        padding: 6px;
        box-sizing: border-box;
        height: 36px;
        border: 1px solid #dbdcdd;
        border-radius: 4px;
        font-size: 15px;
        font-weight: bold;
        margin: 0 auto;
        display: block;
    }
    
    select.value-input {
        width: 100%;
        height: 36px;
        padding: 6px;
        border-radius: 4px;
        border: 1px solid #dbdcdd;
        font-size: 15px;
        box-sizing: border-box;
        margin: 0 auto;
        display: block;
        font-weight: bold;
    }
    
    .add-journey-form {
        background-color: rgba(255, 255, 255, 0.95);
        border-radius: 8px;
        padding: 18px 15px;
        align-items: center;
        justify-content: center;
        width: 85%;
        max-width: 700px;
        margin: 0 auto;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .add-journey-form h2 {
        color: #000080;
        text-align: center;
        margin-bottom: 15px;
        font-size: 20px;
    }
    
    .add-journey-form label {
        font-weight: bold;
        min-width: 130px;
        margin-right: 10px;
        text-align: left;
    }
    
    .add-journey-form input[type="datetime-local"] {
        padding: 6px;
    }
    
    .form-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
    }
    
    .add-journey-form button[type="submit"] {
        width: 100%;
        max-width: 250px;
        padding: 10px;
        margin: 15px auto 0;
        font-size: 16px;
        background-color: #000080;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }
    
    .add-journey-form button[type="submit"]:hover {
        background-color: #1a237e;
    }
    
    @media only screen and (max-width: 768px) {
        .form-group {
            flex-direction: row;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .form-group label {
            min-width: 110px;
            margin-right: 8px;
            margin-bottom: 0;
            width: auto;
        }
        
        .add-journey-form label {
            min-width: 110px;
            margin-right: 8px;
            width: auto;
        }
        
        select, input {
            width: calc(100% - 120px);
            max-width: none;
        }
        
        .user-table-container {
            padding: 0 5px;
            width: 90%;
        }
        
        .add-journey-form {
            padding: 15px 12px;
            width: 90%;
        }
        
        .user-table {
            max-width: 100%;
        }
        
        .user-table td select,
        .user-table td input {
            max-width: 100%;
            width: 100%;
        }
    }
    


    
    @media only screen and (max-width: 380px) {
        .rectangle-row,
        .add-journey-form {
            width: 95%;
            padding: 10px 5px;
        }
        
        .user-table {
            font-size: 11px;
        }
        
        .user-table-container {
            width: 98%;
            padding: 0 1px;
            margin: 10px auto;
        }
        
        th, td {
            padding: 5px 2px;
        }
        
        .value-input,
        select.value-input {
            max-width: 100%;
            font-size: 11px;
            height: 28px;
            padding: 3px;
        }
        
        .update-button,
        .delete-button {
            font-size: 11px;
            padding: 5px;
        }
        
        .user-table tr:last-child td button {
            min-width: 85px;
            padding: 5px;
            font-size: 11px;
        }
        
        .add-journey-form button[type="submit"] {
            max-width: 200px;
            padding: 7px;
            font-size: 13px;
        }
        
        .form-group label {
            font-size: 12px;
            margin-bottom: 2px;
        }
        
        .add-journey-form label {
            font-size: 12px;
            margin-bottom: 2px;
        }
        
        select, input {
            font-size: 12px;
            height: 30px;
            padding: 4px;
            margin-bottom: 4px;
        }
        
        input[type="datetime-local"] {
            font-size: 11px;
        }
        
        .user-table td select,
        .user-table td input {
            font-size: 11px;
            height: 28px;
            padding: 3px;
        }
        
        .user-table form {
            padding: 0;
        }
    }
    
    
</style>


<div class="admin_background">
    <div class="booking_status">
        <div class="Report_title">
            <h1>Journey Management</h1>
        </div>

        <div class="rectangle-row">
            <form action="{{ url_for('search_journey') }}" method="POST">
                <label for="option_type">Type</label>
                <select name="option_type" id="option" onchange="toggleForms()" required>
                    <option value="" selected disabled>Select an option</option>
                    <option value="Modify journey">Modify journey</option>
                    <option value="Add journey">Add journey</option>
                </select>

                <div id="JourneyInput">
                    <label for="JourneyID">Journey ID</label>
                    <input type="number" id="JourneyID" name="JourneyID" min="1" step="1">
                </div>

                <button type="submit" style="width: 50%;">Submit</button>
            </form>
        </div>

        {% if notFound %}
        <h2 style="color: rgb(255, 255, 255); text-align: center;">{{ notFound }}</h2>
        {% endif %}

        <!-- Add Journey Form -->
        <div id="addJourneyForm" class="add-journey-form" style="display: none;">
            <h2 style="color: #000080; text-align: center;">Add New Journey</h2>
            <form action="/add_journey" method="post" class="form-container">
                <div class="form-group">
                    <label for="company">Company:</label>
                    <select name="company" id="company" required>
                        <option value="" selected disabled>Select company</option>
                        <option value="AirExpress">AirExpress</option>
                        <option value="SkyWings">SkyWings</option>
                        <option value="JetStream">JetStream</option>
                        <option value="MetroAir">MetroAir</option>
                        <option value="SkyLink">SkyLink</option>
                        <option value="AirNova">AirNova</option>
                        <option value="WingJet">WingJet</option>
                        <option value="HorizonAir">HorizonAir</option>
                        <option value="SkyTravel">SkyTravel</option>
                        <option value="AirScot">AirScot</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="departure">Departure City:</label>
                    <select name="departure" id="departure" required>
                        <option value="" selected disabled>Select a city</option>
                        <option value="Aberdeen">Aberdeen</option>
                        <option value="Birmingham">Birmingham</option>
                        <option value="Bristol">Bristol</option>
                        <option value="Cardiff">Cardiff</option>
                        <option value="Dundee">Dundee</option>
                        <option value="Edinburgh">Edinburgh</option>
                        <option value="Glasgow">Glasgow</option>
                        <option value="London">London</option>
                        <option value="Manchester">Manchester</option>
                        <option value="Newcastle">Newcastle</option>
                        <option value="Portsmouth">Portsmouth</option>
                        <option value="Southampton">Southampton</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="arrival">Destination City:</label>
                    <select name="arrival" id="arrival" required>
                        <option value="" selected disabled>Select a city</option>
                        <option value="Aberdeen">Aberdeen</option>
                        <option value="Birmingham">Birmingham</option>
                        <option value="Bristol">Bristol</option>
                        <option value="Cardiff">Cardiff</option>
                        <option value="Dundee">Dundee</option>
                        <option value="Edinburgh">Edinburgh</option>
                        <option value="Glasgow">Glasgow</option>
                        <option value="London">London</option>
                        <option value="Manchester">Manchester</option>
                        <option value="Newcastle">Newcastle</option>
                        <option value="Portsmouth">Portsmouth</option>
                        <option value="Southampton">Southampton</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="departure_datetime">Departure Date & Time:</label>
                    <input type="datetime-local" id="departure_datetime" name="departure_datetime" required>
                </div>

                <div class="form-group">
                    <label for="arrival_datetime">Arrival Date & Time:</label>
                    <input type="datetime-local" id="arrival_datetime" name="arrival_datetime" required>
                </div>

                <div class="form-group">
                    <label for="price">Price (£):</label>
                    <input type="number" id="price" name="new_price" min="50" step="0.01" required>
                </div>

                <button type="submit">Add Journey</button>
            </form>
        </div>

        {% if update_journey and read_journey %}
        <div id="modifyJourneyForm" class="user-table-container">
            <table class="user-table" border="1">
                <tr>
                    <th>Category</th>
                    <th>Current Details</th>
                    <th>New Value</th>
                </tr>
                <form action="/update_journey" name="update_journey" method="post">
                    <input type="hidden" name="JourneyID" value="{{ read_journey['Journey_ID'] }}">
                    <tr>
                        <td>Journey ID</td>
                        <td>{{ read_journey['Journey_ID'] }}</td>
                        <td>
                            <button style="width: 100%; background:#000080;" type="submit">Update Journey</button>
                        </td>
                    </tr>

                    <tr>
                        <td>Departure</td>
                        <td>{{ update_journey['Departure City'] }}</td>
                        <td>
                            <select name="departure" required>
                                <option value="{{ update_journey['Departure City'] }}" selected>
                                    {{ update_journey['Departure City'] }}
                                </option>
                                <option value="Aberdeen">Aberdeen</option>
                                <option value="Birmingham">Birmingham</option>
                                <option value="Bristol">Bristol</option>
                                <option value="Cardiff">Cardiff</option>
                                <option value="Dundee">Dundee</option>
                                <option value="Edinburgh">Edinburgh</option>
                                <option value="Glasgow">Glasgow</option>
                                <option value="London">London</option>
                                <option value="Manchester">Manchester</option>
                                <option value="Newcastle">Newcastle</option>
                                <option value="Portsmouth">Portsmouth</option>
                                <option value="Southampton">Southampton</option>
                            </select>
                        </td>
                    </tr>

                    <tr>
                        <td>Arrival</td>
                        <td>{{ update_journey['Destination City'] }}</td>
                        <td>
                            <select name="arrival" required>
                                <option value="{{ update_journey['Destination City'] }}" selected>
                                    {{ update_journey['Destination City'] }}
                                </option>
                                <option value="Aberdeen">Aberdeen</option>
                                <option value="Birmingham">Birmingham</option>
                                <option value="Bristol">Bristol</option>
                                <option value="Cardiff">Cardiff</option>
                                <option value="Dundee">Dundee</option>
                                <option value="Edinburgh">Edinburgh</option>
                                <option value="Glasgow">Glasgow</option>
                                <option value="London">London</option>
                                <option value="Manchester">Manchester</option>
                                <option value="Newcastle">Newcastle</option>
                                <option value="Portsmouth">Portsmouth</option>
                                <option value="Southampton">Southampton</option>
                            </select>
                        </td>
                    </tr>

                    <tr>
                        <td>Departure Time</td>
                        <td>{{ update_journey['Departure Date']}} | {{update_journey['Departure Time']}}</td>
                        <td>
                            <input type="datetime-local" name="new_departure_time"
                                value="{{ update_journey['Departure Date']}}T{{update_journey['Departure Time']}}" required>
                        </td>
                    </tr>

                    <tr>
                        <td>Arrival Time</td>
                        <td>{{ update_journey['Arrival Date']}} | {{update_journey['Arrival Time']}}</td>
                        <td>
                            <input type="datetime-local" name="new_arrival_time"
                                value="{{ update_journey['Arrival Date']}}T{{update_journey['Arrival Time']}}" required>
                        </td>
                    </tr>

                    <tr>
                        <td>Price</td>
                        <td>£{{ update_journey['Base Price'] }}</td>
                        <td>
                            <input type="number" name="new_price" min="50" value="{{ update_journey['Base Price'] }}" required>
                        </td>
                    </tr>
                </form>

                <tr>
                    <td colspan="3">
                        <form action="/delete_journey" method="post" class="delete-form">
                            <input type="hidden" name="Journey_ID" value="{{ read_journey['Journey_ID'] }}">
                            <button type="submit" class="delete-button">Delete Journey</button>
                        </form>
                    </td>
                </tr>
            </table>
        </div>
        {% endif %}
    </div>
</div>

{% if error_message %}
<div id="error-box">
    <button onclick="closeErrorBox()">X</button>
    <p>{{ error_message }}</p>
</div>
{% endif %}

<script>
    function toggleForms() {
        var option = document.getElementById("option").value;
        var JourneyInput = document.getElementById("JourneyInput");
        var JourneyID = document.getElementById("JourneyID");
        var addForm = document.getElementById("addJourneyForm");
        var modifyForm = document.getElementById("modifyJourneyForm");

        if (addForm) addForm.style.display = "none";
        if (modifyForm) modifyForm.style.display = "none";

        if (option === "Modify journey") {
            JourneyInput.style.display = "block";
            JourneyID.required = true;
            if (modifyForm) modifyForm.style.display = "block";
        } else if (option === "Add journey") {
            JourneyInput.style.display = "none";
            JourneyID.required = false;
            if (addForm) addForm.style.display = "block";
        } else {
            JourneyInput.style.display = "none";
            JourneyID.required = false;
        }
    }

    window.addEventListener('beforeunload', function() {
        var option = document.getElementById("option");
        if (option) {
            sessionStorage.setItem('selectedOption', option.value);
        }
        
        var journeyID = document.getElementById("JourneyID");
        if (journeyID) {
            sessionStorage.setItem('journeyID', journeyID.value);
        }
    });

    document.addEventListener('DOMContentLoaded', function () {
        var savedOption = sessionStorage.getItem('selectedOption');
        var savedJourneyID = sessionStorage.getItem('journeyID');
        
        var option = document.getElementById("option");
        if (option && savedOption) {
            option.value = savedOption;
        }
        
        var journeyID = document.getElementById("JourneyID");
        if (journeyID && savedJourneyID) {
            journeyID.value = savedJourneyID;
        }
        
        sessionStorage.removeItem('selectedOption');
        sessionStorage.removeItem('journeyID');
        
        toggleForms();
    });
</script>

{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='java.js') }}"></script>
{% endblock %}